{{> head}}
{{> header}}

<main class="site-root">
  <section class="my-courses-section">
    <div class="container">
      <div class="courses-panel">
        <div class="lecturer-admin-container">
          <div class="lecturer-header">
            <h2 class="lecturer-title">Manajemen Lecturer</h2>
            <button class="lecturer-btn-tambah" onclick="openTambahLecturerModal()">
              <span class="plus-icon">âŠ•</span> Tambah Data
            </button>
          </div>

          {{#if lecturers.length}}
          <div class="lecturer-card">
            {{#each lecturers}}
            <div class="lecturer-item">
              <div class="lecturer-info">
                <div class="lecturer-icon"></div>
                <span class="lecturer-name">{{this.full_name}}</span>
              </div>
              <div class="lecturer-actions">
                <button class="lecturer-btn lecturer-btn-edit" onclick="openEditLecturerModal('{{this.id}}', '{{this.full_name}}', '{{this.expertise}}', '{{this.phone}}', '{{this.email}}')">Edit</button>
                <button class="lecturer-btn lecturer-btn-hapus" onclick="deleteLecturer('{{this.id}}', '{{this.full_name}}')">Hapus</button>
              </div>
            </div>
            {{/each}}
          </div>
          {{else}}
          <div class="empty-courses empty-centered">
            <p class="empty-message">Belum ada lecturer terdaftar</p>
            <p class="empty-sub">Klik "Tambah Data" untuk menambahkan lecturer baru</p>
          </div>
          {{/if}}
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Modal Tambah Lecturer -->
<div id="tambahLecturerModal" class="kursus-modal">
  <div class="kursus-modal-content">
    <div class="modal-logo">
      <img src="/img/logo-pngegg.png" alt="Pluvia Academy" class="modal-logo-img"/>
      <h2>Pluvia Academy</h2>
    </div>
    
    <h3 class="modal-title">Tambah Lecturer</h3>
    
    <form id="tambahLecturerForm" method="POST" action="/lecturer/create">
      <input type="text" name="full_name" placeholder="Nama Lengkap" required class="modal-input"/>
      
      <input type="text" name="expertise" placeholder="Riwayat Pendidikan" class="modal-input"/>
      
      <input type="tel" name="phone" placeholder="Nomor Hp" required class="modal-input"/>
      
      <input type="email" name="email" placeholder="Email" required class="modal-input"/>
      
      <input type="password" name="password" placeholder="Password" required class="modal-input"/>
      
      <div class="modal-actions">
        <button type="submit" class="modal-btn modal-btn-tambah">Tambah</button>
        <button type="button" class="modal-btn modal-btn-batal" onclick="closeTambahLecturerModal()">Batal</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Edit Lecturer -->
<div id="editLecturerModal" class="kursus-modal">
  <div class="kursus-modal-content">
    <div class="modal-logo">
      <img src="/img/logo-pngegg.png" alt="Pluvia Academy" class="modal-logo-img"/>
      <h2>Pluvia Academy</h2>
    </div>
    
    <h3 class="modal-title">Edit Lecturer</h3>
    
    <form id="editLecturerForm" method="POST">
      <input type="text" id="editFullName" name="full_name" placeholder="Nama Lengkap" required class="modal-input"/>
      
      <input type="text" id="editExpertise" name="expertise" placeholder="Riwayat Pendidikan" class="modal-input"/>
      
      <input type="tel" id="editPhone" name="phone" placeholder="Nomor Hp" required class="modal-input"/>
      
      <input type="email" id="editEmail" name="email" placeholder="Email" required class="modal-input"/>
      
      <input type="password" id="editPassword" name="password" placeholder="Password (kosongkan jika tidak diubah)" class="modal-input"/>
      
      <div class="modal-actions">
        <button type="submit" class="modal-btn modal-btn-edit">Edit</button>
        <button type="button" class="modal-btn modal-btn-batal" onclick="closeEditLecturerModal()">Batal</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Konfirmasi Hapus Lecturer -->
<div id="deleteLecturerModal" class="kursus-modal">
  <div class="kursus-modal-content logout-modal-content">
    <div class="modal-logo">
      <img src="/img/logo-pngegg.png" alt="Pluvia Academy" class="modal-logo-img"/>
      <h2>Pluvia Academy</h2>
    </div>
    <h3 class="modal-title">Konfirmasi Hapus</h3>
    <p class="logout-message" id="deleteLecturerMessage">Apakah Anda yakin ingin menghapus lecturer ini?</p>
    
    <div class="modal-actions">
      <button type="button" class="modal-btn modal-btn-logout" onclick="confirmDeleteLecturer()">Ya, Hapus</button>
      <button type="button" class="modal-btn modal-btn-batal" onclick="closeDeleteLecturerModal()">Batal</button>
    </div>
  </div>
</div>

<script>
let deleteLecturerTarget = { id: null, name: null };

function openTambahLecturerModal() {
  document.getElementById('tambahLecturerModal').style.display = 'flex';
}

function closeTambahLecturerModal() {
  document.getElementById('tambahLecturerModal').style.display = 'none';
}

function openEditLecturerModal(id, fullName, expertise, phone, email) {
  const modal = document.getElementById('editLecturerModal');
  const form = document.getElementById('editLecturerForm');
  
  form.action = `/lecturer/${id}/edit`;
  document.getElementById('editFullName').value = fullName || '';
  document.getElementById('editExpertise').value = expertise || '';
  document.getElementById('editPhone').value = phone || '';
  document.getElementById('editEmail').value = email || '';
  document.getElementById('editPassword').value = '';
  
  modal.style.display = 'flex';
}

function closeEditLecturerModal() {
  document.getElementById('editLecturerModal').style.display = 'none';
}

function deleteLecturer(id, name) {
  deleteLecturerTarget = { id, name };
  document.getElementById('deleteLecturerMessage').textContent = `Apakah Anda yakin ingin menghapus lecturer "${name}"?`;
  document.getElementById('deleteLecturerModal').style.display = 'flex';
}

function closeDeleteLecturerModal() {
  document.getElementById('deleteLecturerModal').style.display = 'none';
  deleteLecturerTarget = { id: null, name: null };
}

function confirmDeleteLecturer() {
  if (!deleteLecturerTarget.id) return;
  
  fetch(`/lecturer/${deleteLecturerTarget.id}`, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => {
    if (response.ok) {
      window.location.reload();
    } else {
      console.error('Gagal menghapus lecturer');
      window.location.reload();
    }
  })
  .catch(error => {
    console.error('Error:', error);
    window.location.reload();
  })
  .finally(() => {
    closeDeleteLecturerModal();
  });
}

// Close modal when clicking outside
window.onclick = function(event) {
  const tambahModal = document.getElementById('tambahLecturerModal');
  const editModal = document.getElementById('editLecturerModal');
  const deleteModal = document.getElementById('deleteLecturerModal');
  
  if (event.target === tambahModal) {
    closeTambahLecturerModal();
  }
  if (event.target === editModal) {
    closeEditLecturerModal();
  }
  if (event.target === deleteModal) {
    closeDeleteLecturerModal();
  }
}
</script>

{{> footer}}
